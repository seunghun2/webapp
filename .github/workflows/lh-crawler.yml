name: LH ì²­ì•½ì„¼í„° ìë™ í¬ë¡¤ë§

on:
  # í¬ë¡¤ë§ ì„ì‹œ ë¹„í™œì„±í™” (2025-11-16)
  # schedule:
  #   - cron: '0 0 * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ë§Œ ê°€ëŠ¥
  workflow_dispatch:

jobs:
  crawl-lh:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Call LH Crawling API
        run: |
          echo "ğŸš€ LH ì²­ì•½ì„¼í„° í¬ë¡¤ë§ ì‹œì‘..."
          
          RESPONSE=$(curl -s -X POST https://project-359401ac.pages.dev/api/crawl/lh \
            -H "Content-Type: application/json")
          
          echo "ğŸ“Š í¬ë¡¤ë§ ê²°ê³¼:"
          echo "$RESPONSE" | jq '.'
          
          # ì„±ê³µ ì—¬ë¶€ í™•ì¸
          SUCCESS=$(echo "$RESPONSE" | jq -r '.success')
          
          if [ "$SUCCESS" = "true" ]; then
            NEW_COUNT=$(echo "$RESPONSE" | jq -r '.newCount')
            UPDATE_COUNT=$(echo "$RESPONSE" | jq -r '.updateCount')
            echo "âœ… í¬ë¡¤ë§ ì„±ê³µ: ì‹ ê·œ ${NEW_COUNT}ê±´, ì—…ë°ì´íŠ¸ ${UPDATE_COUNT}ê±´"
          else
            echo "âŒ í¬ë¡¤ë§ ì‹¤íŒ¨"
            exit 1
          fi
      
      - name: Notify on failure
        if: failure()
        run: |
          echo "âš ï¸ LH í¬ë¡¤ë§ ì‹¤íŒ¨! GitHub Actions ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”."
