name: ì²­ì•½í™ˆ ìë™ í¬ë¡¤ë§

on:
  # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤ì „ 8ì‹œ 30ë¶„ (UTC 23:30, ì „ë‚ ) ìë™ ì‹¤í–‰
  schedule:
    - cron: '30 23 * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥
  workflow_dispatch:

jobs:
  crawl-applyhome:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Call ì²­ì•½í™ˆ Crawling API
        run: |
          echo "ğŸš€ ì²­ì•½í™ˆ í¬ë¡¤ë§ ì‹œì‘..."
          
          RESPONSE=$(curl -s -X POST https://hanchae365.com/api/crawl/applyhome \
            -H "Content-Type: application/json")
          
          echo "ğŸ“Š í¬ë¡¤ë§ ê²°ê³¼:"
          echo "$RESPONSE" | jq '.'
          
          # ì„±ê³µ ì—¬ë¶€ í™•ì¸
          SUCCESS=$(echo "$RESPONSE" | jq -r '.success')
          
          if [ "$SUCCESS" = "true" ]; then
            NEW_COUNT=$(echo "$RESPONSE" | jq -r '.newCount')
            UPDATE_COUNT=$(echo "$RESPONSE" | jq -r '.updateCount')
            echo "âœ… í¬ë¡¤ë§ ì„±ê³µ: ì‹ ê·œ ${NEW_COUNT}ê±´, ì—…ë°ì´íŠ¸ ${UPDATE_COUNT}ê±´"
          else
            echo "âŒ í¬ë¡¤ë§ ì‹¤íŒ¨"
            exit 1
          fi
      
      - name: Notify on failure
        if: failure()
        run: |
          echo "âš ï¸ ì²­ì•½í™ˆ í¬ë¡¤ë§ ì‹¤íŒ¨! GitHub Actions ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”."
